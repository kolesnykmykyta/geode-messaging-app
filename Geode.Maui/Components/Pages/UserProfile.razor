@page "/profile"
@inject IUsersService usersService

<h3>Your profile</h3>

<div>
    <h4>Profile info</h4>
    <div class="justify-content-center">
    <EditForm Model="@profileData" OnSubmit="ChangeProfileDataAsync" FormName="profileData" class="form-group w-50" style="margin:auto">
        <div class="mt-2">
            <label for="username">Username</label>
            <InputText id="username" @bind-Value="@profileData.UserName" class="form-control" required></InputText>
        </div>
        <div class="mt-2">
            <label for="phone">Phone number</label>
            <InputText id="phone" @bind-Value="@profileData.PhoneNumber" class="form-control" required></InputText>
        </div>
        <div class="d-flex flex-row-reverse">
            <button type="submit" class="btn btn-primary mt-4">Submit</button>
        </div>
    </EditForm>
    <p>@Message</p>
</div>
</div>
<div>

</div>
@code {
    private UserProfileDto profileData { get; set; } = new();
    private string? Message { get; set; }

    protected override async Task OnInitializedAsync()
    {
        profileData = await usersService.GetUserProfileAsync() ?? new();
    }

    private async Task ChangeProfileDataAsync(EditContext context)
    {
        Message = "Updating your profile...";
        UserProfileDto contextDto = (UserProfileDto)context.Model;
        bool result = await usersService.UpdateUserProfileAsync(contextDto);
        Message = result ? "Successfully updated!" : "Profile update had failed.";
    }
}
